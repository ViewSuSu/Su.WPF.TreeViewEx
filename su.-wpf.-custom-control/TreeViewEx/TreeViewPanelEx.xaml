<UserControl
    x:Class="Su.WPF.CustomControl.TreeViewEx.TreeViewPanel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:converters="clr-namespace:Su.WPF.CustomControl.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Su.WPF.CustomControl.TreeViewEx"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:myTreeViewExtentsion="clr-namespace:Su.WPF.CustomControl.TreeViewEx"
    d:DataContext="{d:DesignInstance Type=local:TreeViewPanelExViewModel}"
    d:DesignHeight="600"
    d:DesignWidth="300"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:ImageLocationToVisibilityConverter x:Key="ImageLocationToVisibilityConverter" />
    </UserControl.Resources>
    <TreeView
        d:ItemsSource="{d:SampleData ItemCount=15}"
        myTreeViewExtentsion:TreeViewExHelper.SelectedItem="{Binding TreeViewExProvider.SelectedTreeNode, Mode=TwoWay}"
        Background="White"
        ItemsSource="{Binding TreeViewExProvider.ShowTreeNodeList, Mode=OneWay}">
        <TreeView.ContextMenu>
            <ContextMenu ItemsSource="{Binding TreeViewExProvider.Options.ShowMenuItemModels, Mode=OneWay}" Visibility="{Binding TreeViewExProvider.Options.IsRightButtonWillShowMenu, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
        </TreeView.ContextMenu>
        <TreeView.ItemContainerStyle>
            <Style TargetType="{x:Type TreeViewItem}">
                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                <!--<Setter Property="FontWeight" Value="Normal" />-->
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="FontWeight" Value="Bold" />
                    </Trigger>
                </Style.Triggers>
            </Style>
        </TreeView.ItemContainerStyle>
        <TreeView.ItemTemplate>
            <HierarchicalDataTemplate ItemsSource="{Binding Path=Children}">
                <StackPanel
                    MinHeight="25"
                    Margin="0,2"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center"
                    IsEnabled="{Binding IsEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Orientation="Horizontal"
                    ToolTip="{Binding Name, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                    Visibility="{Binding IsVisible, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel.ContextMenu>
                        <ContextMenu ItemsSource="{Binding ShowMenuItemModels, Mode=OneWay}" Visibility="{Binding IsRightButtonWillShowMenu, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel.ContextMenu>
                    <!--  图片在左侧的情况  -->
                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="PreviewMouseRightButtonDown">
                            <b:InvokeCommandAction Command="{Binding MouseRightButtonDownCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}}" />
                        </b:EventTrigger>
                    </b:Interaction.Triggers>
                    <Image
                        Margin="2,0,0,0"
                        VerticalAlignment="Center"
                        Source="{Binding ImageSource, Mode=OneWay}"
                        Stretch="UniformToFill"
                        Visibility="{Binding ImageSourceLocation, Converter={StaticResource ImageLocationToVisibilityConverter}, ConverterParameter=Left, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" />

                    <!--  CheckBox  -->
                    <CheckBox
                        VerticalContentAlignment="Center"
                        d:Visibility="Visible"
                        IsChecked="{Binding IsChecked, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        Visibility="{Binding IsShowCheckBox, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BoolToVisibilityConverter}}" />

                    <!--  图片在中间的情况  -->
                    <Image
                        Margin="2,0,0,0"
                        VerticalAlignment="Center"
                        Source="{Binding ImageSource, Mode=OneWay}"
                        Stretch="UniformToFill"
                        Visibility="{Binding ImageSourceLocation, Converter={StaticResource ImageLocationToVisibilityConverter}, ConverterParameter=Middle, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" />

                    <!--  TextBlock  -->
                    <TextBlock
                        VerticalAlignment="Center"
                        d:Text="123"
                        Text="{Binding Name}" />

                    <!--  图片在右侧的情况  -->
                    <Image
                        Margin="2,0,0,0"
                        VerticalAlignment="Center"
                        Source="{Binding ImageSource, Mode=OneWay}"
                        Stretch="UniformToFill"
                        Visibility="{Binding ImageSourceLocation, Converter={StaticResource ImageLocationToVisibilityConverter}, ConverterParameter=Right, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>
            </HierarchicalDataTemplate>
        </TreeView.ItemTemplate>
    </TreeView>
</UserControl>
